<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>nope</title>
		<link rel="icon" href="../../images/favicon.png" sizes="16x16" type="image/png">
		<link rel="stylesheet" type="text/css" href="logic.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body>
		<script src="https://threejs.org/build/three.min.js"></script>
		<script>
			var x = 0, z = 10, dir = 1, target = 0, next = 1, dx = 0, dz = 0, actual = 0;
			
			var code = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";
			
			var data = "YUXZRJPTCS7GFF6MKL4YUXZRJPTCS7GFF6A";
			
			
			var converted = "";
			for (var t = 0; t < data.length; t++) {
				converted += code.indexOf(data.charAt(t)).toString(2);
			}
			
			var matrix = [];
			
			var scene = new THREE.Scene();
			//scene.background = new THREE.Color( 0xffffff );
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000 );

			var renderer = new THREE.WebGLRenderer( { antialias: true } );
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			var n = 0;
			for ( var i = 0; i <= 19; i++ ) {
				var row = [];
				for ( var j = 0; j <= 19; j++ ) {
					row.push(converted.charAt(n) === "1");
					if (converted.charAt(n) === "1") {
						var geometry = new THREE.BoxGeometry( 1, 1, 1 );
						var material = new THREE.MeshPhongMaterial( { color: 0x0000ff } );
						var cube = new THREE.Mesh( geometry, material );
						cube.position.set( i, 0, j );
						scene.add( cube );
					}
					n++;
				}
				console.log(row);
				matrix.push(row);
			}
			
			var light = new THREE.PointLight( 0xffffff, 1, 100 );
			scene.add( light );
			

			var animate = function () {
				requestAnimationFrame( animate );
				
				var center = Math.abs(dx) >= 1 || Math.abs(dz) >= 1 || (dx == 0 && dz == 0);
				
				if (center) {
					dir = next;
					x = Math.round(x + dx);
					z = Math.round(z + dz);
					dx = 0;
					dz = 0;
				}
				if (dir === 0) {
					if ( !matrix[x - 1] || !center || !matrix[x - 1][z] ) {
						dx -= 0.05;
					}
				} else if (dir === 1) {
					if ( !matrix[x] || !center || !matrix[x][z - 1] ) {
						dz -= 0.05;
					}
				} else if (dir === 2) {
					if ( !matrix[x + 1] || !center || !matrix[x + 1][z] ) {
						dx += 0.05;
					}
				} else {
					if ( !matrix[x] || !center || !matrix[x][z + 1] ) {
						dz += 0.05;
					}
				}
				
				camera.position.set( x + dx, 1, z + dz );
				light.position.set( x + dx, 2, z + dz );
				
				actual = Math.PI * -(dir - 1) / 2;
				console.log(actual + "  " + target);
				if (actual < -3 && target > 1.5) {
					actual = -actual;
				} else if (actual < -1.5 && target > 3) {
					target = -target;
				} else if (actual > 1.5 && target < -3) {
					target = -target;
				}
				if (actual > target) {
					target += 0.1;
				} else if (actual < target) {
					target -= 0.1;
				}
				if (Math.abs(actual - target) < 0.05) {
					target = actual;
				}
				camera.rotation.y = target;

				renderer.render(scene, camera);
			};

			animate();
			
			document.body.onkeydown = function() {
				if (target === actual) {
					if (window.event.keyCode === 37) {
						next = (dir + 3) % 4;
					} else if (window.event.keyCode === 39) {
						next = (dir + 1) % 4;
					}
				}
			}
		</script>
	</body>
</html>
