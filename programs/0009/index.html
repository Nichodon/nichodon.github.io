<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Breakout Revamped</title>
<link rel="stylesheet" type="text/css" href="../../styles.css">
<link rel="icon" href="../../images/favicon.png" sizes="16x16" type="image/png">
<link rel="stylesheet" type="text/css" href="break.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="top"></div>

<div class="content">
<h1>Breakout Revamped</h1>
<p>2 September, 2017 &ndash; <a href="https://github.com/Nichodon" target="_blank">Nichodon</a></p>

<div class="article">

<div id="container">
	<canvas id="canvas" width="1000" height="500"></canvas>
</div>

<div class="separate"></div>
</div>
</div>

<div id="bottom"></div>

<script src="../../frame.js"></script>
<script src="../../querystring.js"></script>

<script>
	class Tetra {
		constructor(x, y, width, height, n) {
			this.x = x;
			this.y = y;
			this.width = width;
			this.height = height;
			this.n = n;
		}
	}
	
	class Ball {
		constructor(x, y, rot, mag, r) {
			this.x = x;
			this.y = y;
			this.rot = rot;
			this.mag = mag;
			this.r = r;
		}
		
		edge() {
			var velx = this.mag * Math.cos(this.rot);
			var vely = this.mag * Math.sin(this.rot);
			var slopex = vely / velx;
			var slopey = velx / vely;
			
			if (this.x > 1000 - this.r) {
				this.y -= slopex * (1000 - this.r - this.x);
				this.x = 1000 - this.r;
				this.rot = Math.PI - this.rot;
			}
			else if (this.x < this.r) {
				this.y -= slopex * (this.r - this.x);
				this.x = this.r;
				this.rot = Math.PI - this.rot;
			}
			if (this.y > 500 - this.r) {
				this.x -= slopey * (500 - this.r - this.y);
				this.y = 500 - this.r;
				this.rot = Math.PI * 2 - this.rot;
			}
			else if (this.y < this.r) {
				this.x -= slopey * (this.r - this.y);
				this.y = this.r;
				this.rot = Math.PI * 2 - this.rot;
			}
		}
		
		four(tetra) {
			var velx = this.mag * Math.cos(this.rot);
			var vely = this.mag * Math.sin(this.rot);
			var slopex = vely / velx;
			var slopey = velx / vely;
			
			if (this.x < tetra.x && 
				(tetra.x - this.x) / tetra.width > Math.abs(tetra.y - this.y) / tetra.height) {
				this.y -= slopex * (tetra.x - tetra.width / 2 - this.r - this.x);
				this.x = tetra.x - tetra.width / 2 - this.r;
				this.rot = Math.PI - this.rot;
			}
			else if (this.x > tetra.x && 
					 (this.x - tetra.x) / tetra.width > Math.abs(tetra.y - this.y) / tetra.height) {
				this.y -= slopex * (tetra.x + tetra.width / 2 + this.r - this.x);
				this.x = tetra.x + tetra.width / 2 + this.r;
				this.rot = Math.PI - this.rot;
			}
			else if (this.y < tetra.y && 
					 (tetra.y - this.y) / tetra.height > Math.abs(tetra.x - this.x) / tetra.width) {
				this.x -= slopey * (tetra.y - tetra.height / 2 - this.r - this.y);
				this.y = tetra.y - tetra.height / 2 - this.r;
				this.rot = Math.PI * 2 - this.rot;
			}
			else if (this.y > tetra.y && 
					 (this.y - tetra.y) / tetra.height > Math.abs(tetra.x - this.x) / tetra.width) {
				this.x -= slopey * (tetra.y + tetra.height / 2 + this.r - this.y);
				this.y = tetra.y + tetra.height / 2 + this.r;
				this.rot = Math.PI * 2 - this.rot;
			}
		}
		
		move() {
			var velx = this.mag * Math.cos(this.rot);
			var vely = this.mag * Math.sin(this.rot);
			
			this.x += velx;
			this.y += vely;
			
			this.edge();
			
			var min = -1;
			var cuat;
			
			for (var i = 0; i < tetras.length; i++) {
				var tetra = tetras[i];
				var dist = Math.sqrt(Math.pow(this.x - tetra.x, 2) + Math.pow(this.y - tetra.y, 2));
				if (dist < min || min === -1) {
					min = dist;
					cuat = tetra;
				}
			}
			if (this.x < cuat.x + cuat.width / 2 + this.r && 
				this.x > cuat.x - cuat.width / 2 - this.r &&
				this.y < cuat.y + cuat.height / 2 + this.r && 
				this.y > cuat.y - cuat.height / 2 - this.r) {
				this.four(cuat);
			}
		}
	}
	
	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");
	
	var balls = [];
	for (var i = 0; i < 16; i++) {
		balls.push(new Ball(100, 100, i * Math.PI / 8 + 0.1, 10, 5));
	}
	var tetras = [];
	for (var i = 0; i < 16; i++) {
		tetras.push(new Tetra(i * 50 + 50, 200, 40, 40, 50));
	}
	
	function bulb() {
		canvas.style.width = document.body.offsetWidth * 0.9375 + "px";
		canvas.style.height = document.body.offsetWidth * 0.46875 + "px";
		document.getElementById("container").style.height = document.body.offsetWidth * 0.46875 + "px";
	
		ctx.fillStyle = "#333";
		ctx.fillRect(0, 0, canvas.width, canvas.height);
		
		for (var i = 0; i < balls.length; i++) {
			var ball = balls[i];
			ctx.fillStyle = "#eee";
			ctx.beginPath();
			ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
			ctx.fill();
			ball.move();
		}
		
		for (var i = 0; i < tetras.length; i++) {
			var tetra = tetras[i];
			ctx.fillStyle = "#096";
			ctx.fillRect(tetra.x - tetra.width / 2, tetra.y - tetra.height / 2, tetra.width, tetra.height);
			ctx.fillStyle = "#fff";
			ctx.font = "10px Segoe UI";
			ctx.strokeText(tetra.n, tetra.x, tetra.y);
		}
	}
	
	setInterval(function() {
		bulb();
	}, 1000 / 60);
</script>

</body>
</html>
